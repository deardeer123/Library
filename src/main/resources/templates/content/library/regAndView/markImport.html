<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{fragment/library/library_detail_layout}">

<th:block layout:fragment="content_css">
    <!-- html 파일이 열릴때 같이 실행되는 css -->
    <!-- <link rel="stylesheet" href="/"> -->
</th:block>

<th:block layout:fragment="contentFragment">
    <!-- html 코드 작성 -->
    <div class="row">
        <div class="col">
            <!-- 바코드 출력 -->
            <div class="row text-center mt-2">
                <div class="col">
                    <h3>바코드 출력</h3>
                </div>

            </div>

            <div class="row mb-2">
                <div class="col-8"></div>
                <div class="col">
                    <input class="form-check-input" type="checkbox" value="" id="allChk" onclick="allChk(this)">
                    <label class="form-check-label" for="allChk">
                        전체 체크하기
                    </label>
                </div>

                <div class="col">
                    <input type="button" class="btn btn-primary" value="출력하기" onclick="printBarCode()">
                </div>
            </div>

            <form action="/bookAdmin/printBarCode" method="post" id="barCode-form">
                <div class="row">
                    <th:block th:each="e:${bookList}">
                        <div class="col" width="220px">
                            <div class="row">
                                <div class="col">

                                    <!-- 책제목 -->
                                    <p
                                        style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 200px;">
                                        <input type="checkbox" class="form-check-input book-code-chkbox" name="bookCodeList"
                                            th:value="${e.bookCode}">
                                        [[${e.bookTitle}]]
                                    </p>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <!-- 바코드 -->
                                    <img alt="Barcoded value ${libraryVO.bookCode}"
                                        th:src="@{http://bwipjs-api.metafloor.com/?bcid=code128&text=} + ${e.bookCode} + @{&includetext}"
                                        width="200px">
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>
            </form>
        </div>
    </div>

    <script>
        function allChk(checkTag) {
            chkboxs = document.querySelectorAll(".form-check-input")
            //console.log(chkboxs);
            if (checkTag.checked == true) {
                for (let e of chkboxs) {
                    e.checked = true
                }
            } else {
                for (let e of chkboxs) {
                    e.checked = false
                }
            }
        }

        function printBarCode() {
            let bookCodeList = []
            let chkboxs = document.querySelectorAll(".book-code-chkbox")
            for (let e of chkboxs) {
                if (e.checked == true) {
                    bookCodeList.push(e.value)
                }

            }
            console.log(bookCodeList)
            if (bookCodeList.length != 0) {

                const formTag = document.querySelector("#barCode-form")
                formTag.submit();
                //location.href=`/bookAdmin/printBarCode/bookCodeLost=${JSON.stringify(bookCodeList)}`
                // fetch('/bookAdmin/printBarCode', { //요청경로
                //     method: 'POST',
                //     cache: 'no-cache',
                //     headers: {
                //         'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                //     },
                //     //컨트롤러로 전달할 데이터
                //     body: new URLSearchParams({
                //         // 데이터명 : 데이터값
                //         bookCodeList : bookCodeList
                //     })
                // })
                //     .then((response) => {
                //         if (!response.ok) {
                //             alert('fetch error!\n컨트롤러로 통신중에 오류가 발생했습니다.');
                //             return;
                //         }

                //         //return response.text(); //컨트롤러에서 return하는 데이터가 없거나 int, String 일 때 사용
                //         return response.json(); //나머지 경우에 사용
                //     })
                //     //fetch 통신 후 실행 영역
                //     .then((data) => {//data -> controller에서 리턴되는 데이터!
                //         console.log(data)
                //         //location.href=``                        

                //     })
                //     //fetch 통신 실패 시 실행 영역
                //     .catch(err => {
                //         alert('fetch error!\nthen 구문에서 오류가 발생했습니다.\n콘솔창을 확인하세요!');
                //         console.log(err);
                //     });

            }


        }
    </script>
</th:block>

<th:block layout:fragment="content_js">
    <!-- html 파일이 열릴때 같이 실행되는 js -->
    <!-- <script src="/"></script> -->
</th:block>

</html>