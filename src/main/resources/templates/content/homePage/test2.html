<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">

    <style>
        /* calendar.html */

        .fc-col-header-cell-cushion,
        .fc-daygrid-day-number {
            text-decoration: none;
        }

        .fc-scrollgrid-sync-inner>.fc-col-header-cell-cushion,
        .fc-day-mon .fc-daygrid-day-number,
        .fc-day-tue .fc-daygrid-day-number,
        .fc-day-wed .fc-daygrid-day-number,
        .fc-day-thu .fc-daygrid-day-number,
        .fc-day-fri .fc-daygrid-day-number {
            color: black;
        }

        .fc-day-sun .fc-col-header-cell-cushion,
        .fc-day-sun a {
            color: red;
        }

        .fc-day-sat .fc-col-header-cell-cushion,
        .fc-day-sat a {
            color: blue;
        }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <!-- datepicker css파일 -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

    <title></title>

</head>

<body>
    <div class="row">
        <div class="col-6">
            <!-- 달력 -->
            <div id='calendar'></div>
        </div>

        <div class="col-6">
            <div class="row">
                <div class="col">
                    <!-- 기능 -->
                    <div class="row mt-2">
                        <div class="col">
                            <h2>일정 추가</h2>
                        </div>
                    </div>

                    <form action="/bookAdmin/calendarAdd" method="post">
                        <div class="row mt-3">
                            <div class="col">
                                일정 이름
                            </div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">
                                <input type="text" name="title" class="form-control">
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                날짜
                            </div>
                        </div>

                        <div class="row mt-1">
                            <!-- <div class="col">
                                <input type="text" name="start" class="form-control">
                            </div> -->

                            <div class="col">
                                <input type="text" class="form-control" id="myInput" onchange="chkDate(this)">
                                <input type="hidden" id="start-tag" name="start" value="">
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                형식(빨간색은 휴관일, 행사, 영화는 파란색  강좌  초록색)
                            </div>
                        </div>

                        <div class="row mt-1">
                            <div class="col">
                                <select class="form-select" name="color">
                                    <option value="blue">영화</option>
                                    <option value="red">휴무일</option>
                                    <option value="green">강의</option>
                                    <option value="blue">행사</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                누르면 이동할 주소(@getmapping에 적혀있는거)
                            </div>
                        </div>

                        <div class="row mt-1">
                            <div class="col">
                                <input type="text" class="form-control" name="url" placeholder="url 입력">
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                <input type="submit" class="btn btn-primary" value="일정 추가하기">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 일정 삭제 -->
            <div class="row mt-2">
                <div class="col">

                    <div class="row mt-3">
                        <div class="col">
                            <h2>일정삭제</h2>
                        </div>
                    </div>

                    <form action="/bookAdmin/calendarDelete" method="post">
                        <div class="row mt-3">
                            <div class="col">
                                일정 이름
                            </div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">
                                <input type="text" name="title" class="form-control">
                            </div>
                        </div>

                        <div class="row mt-1">
                            <div class="col">
                                날짜
                            </div>
                        </div>

                        <div class="row mt-1">
                            <div class="col">
                                <input type="text" name="strat" class="form-control" id="myInput2">
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                <input type="submit" class="btn btn-primary" value="일정 삭제하기">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>


     <!-- jquery -->
     <script src="https://code.jquery.com/jquery-latest.min.js"></script>
     <!-- datepicker 자바스크립트 -->
     <script
         src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"> </script>
     <!-- datepicker 한글 사용하기 위한 자바스크립트 -->
     <script
         src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ko.min.js"
         integrity="sha512-L4qpL1ZotXZLLe8Oo0ZyHrj/SweV7CieswUODAAPN/tnqN3PA1P+4qPu5vIryNor6HQ5o22NujIcAZIfyVXwbQ=="
         crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- 달력 자바스크립트 -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script>
        // 왜 날짜가 안넘어가는지 모르겠음 이렇게라도 넘겨야지
        let chkDate = (tag)=>{
            document.querySelector("#start-tag").value = tag.value
        }
        
        calendarData();

        //해당 페이지 들어오면 바로 캘린더 정보 불러오기
        

        //날짜정하는 자바스크립트
        $('#myInput').datepicker({
            format: "yyyy-mm-dd", //날짜 형식
            autoclose: true, //사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
            language: 'ko' //달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.
        });

        //날짜정하는 자바스크립트
        $('#myInput2').datepicker({
            format: "yyyy-mm-dd", //날짜 형식
            autoclose: true, //사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
            language: 'ko' //달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.
        });

        //캘린더
        function calendarData() {
            // ------------------- 첫번째 방식 ---------------//
            fetch('/bookAdmin/calendarDataFetch', { //요청경로
                method: 'POST',
                cache: 'no-cache',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                },
                //컨트롤러로 전달할 데이터
                body: new URLSearchParams({
                    // 데이터명 : 데이터값
                })
            })
                .then((response) => {
                    if (!response.ok) {
                        alert('fetch error!\n컨트롤러로 통신중에 오류가 발생했습니다.');
                        return;
                    }
                    //return response.text(); //컨트롤러에서 return하는 데이터가 없거나 int, String 일 때 사용
                    return response.json(); //나머지 경우에 사용
                })
                //fetch 통신 후 실행 영역
                .then((data) => {//data -> controller에서 리턴되는 데이터!
                    let eventList = data
                    console.log(eventList)

                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        // 높이
                        height: 650,
                        // 캘린더 형식
                        initialView: 'dayGridMonth',
                        //시간표시 제거하기
                        displayEventTime: false,
                        //한글표시
                        locale: 'ko',
                        //이벤트
                        events: eventList

                    });
                    calendar.render();
                })
                //fetch 통신 실패 시 실행 영역
                .catch(err => {
                    alert('fetch error!\nthen 구문에서 오류가 발생했습니다.\n콘솔창을 확인하세요!');
                    console.log(err);
                });
        }

        
        
    </script>
</body>

</html>