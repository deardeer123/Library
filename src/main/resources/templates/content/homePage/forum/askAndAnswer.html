<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragment/homePage/homePage_detail_layout}">

<th:block layout:fragment="content_css">
  <!-- html íŒŒì¼ì´ ì—´ë¦´ë•Œ ê°™ì´ ì‹¤í–‰ë˜ëŠ” css -->
  <!-- <link rel="stylesheet" href="/"> -->
</th:block>

<th:block layout:fragment="contentFragment">
  <!-- html ì½”ë“œ ì‘ì„± -->
  <div class="row">
    <div class="col">
      <!-- ê²€ìƒ‰ ê¸°ëŠ¥-->

      <div class="row mt-3">
        <div class="col-3">
          <div class="input-group mb-3">
            <select class="form-select" name="searchType">
              <option value="BOARD_TITLE" th:selected="${searchVO.searchType == 'boardTitle'}">ì œëª©</option>
            </select>
          </div>
        </div>

        <div class="col-5">
          <input type="text" class="form-control" name="searchValue" th:value="${searchVO.searchValue}"
            aria-label="Text input with dropdown button">
        </div>

        <div class="col-2">
          <input type="submit" class="btn btn-outline-secondary" value="ê²€ìƒ‰" id="inputGroupFileAddon04">
        </div>

      </div>

      <!-- ì „ì²´ ê²Œì‹œë¬¼ ê°¯ìˆ˜ -->
      <div class="row">
        <div class="col">
          ì „ì²´ê²Œì‹œê¸€ ìˆ˜ ì´ [[${normalTotalBoardCnt}]] ê°œ
        </div>
      </div>

      <!-- ê²Œì‹œë¬¼ ëª©ë¡ -->
      <div class="row mt-3">
        <div class="col">
          <table class="table table-bordered align-middle text-center">
            <colgroup>
              <col width="10%">
              <col width="*">
              <col width="15%">
              <col width="15%">
              <col width="15%">
            </colgroup>
            <thead>
              <tr>
                <td>ë²ˆí˜¸</td>
                <td>ì œëª©</td>
                <td>ì‘ì„±ì</td>
                <td>ë“±ë¡ì¼</td>
                <td>ì¡°íšŒìˆ˜</td>
              </tr>
            </thead>

            <tbody>
              <!-- ì¡°íšŒëœ ë¬»ê³  ë‹µí•˜ê¸° ê²Œì‹œë¬¼ë“¤ -->

              <th:block th:each="e3, state :${boardVOList}">
                <tr th:onclick="detailAskBoard([[${e3.boardNum}]], [[${e3.askAndAnswerBoardVO.askAndAnswerBoardPublicOrPrivate}]],
                 [[${isAdmin}]], [[${userCode}]], [[${e3.userCode}]], [[${e3.askAndAnswerBoardVO.chkAskUserCode}]])">
                  <td>[[${#lists.size(boardVOList) - state.index}]]</td>
                  <td>
                    <!-- ë§Œì•½ì— ë¹„ë°€ê¸€ ì¸ê²½ìš° -->
                    <th:block th:if="${e3.askAndAnswerBoardVO.askAndAnswerBoardPublicOrPrivate == 'private'}">ğŸ”’
                    </th:block>
                    [[${e3.boardTitle}]]
                  </td>
                  <td>[[${e3.memberVO.userName}]]</td>
                  <td>[[${e3.boardDate}]]</td>
                  <td>[[${e3.boardCnt}]]</td>
                </tr>
              </th:block>
            </tbody>


          </table>
        </div>
      </div>

    </div>
  </div>


  <!-- í˜ì´ì§•ì²˜ë¦¬ -->

  <div class="col-12 text-center">
    <th:block th:if="${searchVO.prev}">
      <a th:href="@{/notice(nowPage=${searchVO.beginPage - 1})}">ì´ì „</a>
    </th:block>
    <th:block th:each=" i : ${#numbers.sequence(searchVO.beginPage, searchVO.endPage)}">
      <a th:href="@{/notice(nowPage=${i})}">[[${i}]]</a>
    </th:block>
    <th:block th:if="${searchVO.next}">
      <a th:href="@{/notice(nowPage=${searchVO.endPage + 1})}">ë‹¤ìŒ</a>
    </th:block>
  </div>

  <div class="row">
    <div class="col">
      <!-- ì´ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹¤ì‹œ 1ë²ˆìœ¼ë¡œ ëŒì•„ê° -->
      <div class="float-start">
        <input type="button" class=" btn btn-primary" value="ëª©ë¡" onclick="location.href='/notice'">
      </div>
    </div>
    <div class="col ">
      <!-- ë¡œê·¸ì¸ í•´ì•¼ì§€ ì‚¬ìš©ê°€ëŠ¥í•œ ê¸€ì“°ê¸° ë²„íŠ¼ -->
      <div class="float-end">
        <input class=" btn btn-primary" type="button" value="ê¸€ì“°ê¸°" onclick="location.href='/askAndAnswerWrite?boardType=30'">
      </div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="passwdModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col">
              <div>
                ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
              </div>
              <div>
                <input type="text" class="form-control" id="chkPasswd">
                <input type="hidden" id="chkBoardNum">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="chkPasswd()">Save changes</button>
        </div>
      </div>
    </div>
  </div>



  <script>
    function detailAskBoard(boardNum, askAndAnswerBoardPublicOrPrivate,
      isAdmin, userCode, boardUserCode, chkAskUserCode) {
      console.log(boardNum)
      console.log(askAndAnswerBoardPublicOrPrivate)
      console.log(isAdmin)

      //ì‘ì„±ìê°€ ì§ˆë¬¸ê¸€ì„ ì“°ê³  ê´€ë¦¬ìê°€ ë‹µë³€í•´ì¤¬ì„ê²½ìš° ì‘ì„±ìëŠ” ìì‹ ì˜ ê¸€ì— ë‹µë³€ ë‹¬ë¦°ê²ƒì„ ê·¸ëƒ¥ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•´ì¤˜ì•¼í•¨

      //ë§Œì•½ì— askAndAnswerBoardPublicOrPrivateì´ publicì¸ ê²½ìš°ëŠ” ë¹„ë°€ê¸€ì´ ì•„ë‹˜.
      if ((askAndAnswerBoardPublicOrPrivate == 'public' | isAdmin == 'Y' |
       userCode == boardUserCode | chkAskUserCode == userCode)) {
        location.href = `/goDetailAskBoard?boardNum=${boardNum}`;
      } else {
        
        // publicì´ ì•„ë‹Œê²½ìš°ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³  ë“¤ì–´ê°
        // ê·¼ë° ê´€ë¦¬ì, ê¸€ì‘ì„±ìëŠ” ê·¸ëƒ¥ ë“¤ì–´ê°€ê²Œ í•˜ê³  ì‹¶ì€ë°
        const passwdModal = new bootstrap.Modal('#passwdModal')
        const chkBoardNumTag = document.querySelector("#chkBoardNum");
        chkBoardNumTag.value = boardNum;
        passwdModal.show();
      }
    }

    function chkPasswd() {
      let passwd = document.querySelector("#chkPasswd").value;
      let chkBoardNumTag = document.querySelector("#chkBoardNum");
      boardNum = chkBoardNumTag.value;

      console.log(passwd)
      console.log(boardNum)

      // ------------------- ì²«ë²ˆì§¸ ë°©ì‹ ---------------//
      fetch('/askBoardPasswordCheckFetch', { //ìš”ì²­ê²½ë¡œ
        method: 'POST',
        cache: 'no-cache',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
        },
        //ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•  ë°ì´í„°
        body: new URLSearchParams({
          // ë°ì´í„°ëª… : ë°ì´í„°ê°’
          passwd : passwd ,
          boardNum , boardNum
        })
      })
        .then((response) => {
          if (!response.ok) {
            alert('fetch error!\nì»¨íŠ¸ë¡¤ëŸ¬ë¡œ í†µì‹ ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            return;
          }

          //return response.text(); //ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ returní•˜ëŠ” ë°ì´í„°ê°€ ì—†ê±°ë‚˜ int, String ì¼ ë•Œ ì‚¬ìš©
          return response.json(); //ë‚˜ë¨¸ì§€ ê²½ìš°ì— ì‚¬ìš©
        })
        //fetch í†µì‹  í›„ ì‹¤í–‰ ì˜ì—­
        .then((data) => {//data -> controllerì—ì„œ ë¦¬í„´ë˜ëŠ” ë°ì´í„°!
          console.log(data)
          if(data.isRight == 'Y'){
            location.href = `/goDetailAskBoard?boardNum=${data.boardNum}`;
          }else{
            alert("ë¹„ë°€ë²ˆí˜¸ í‹€ë ¸ì–´ìš”")
            location.href = `/askAndAnswer`;
          }

        })
        //fetch í†µì‹  ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ ì˜ì—­
        .catch(err => {
          alert('fetch error!\nthen êµ¬ë¬¸ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì½˜ì†”ì°½ì„ í™•ì¸í•˜ì„¸ìš”!');
          console.log(err);
        });

    }


  </script>
</th:block>

<th:block layout:fragment="content_js">
  <!-- html íŒŒì¼ì´ ì—´ë¦´ë•Œ ê°™ì´ ì‹¤í–‰ë˜ëŠ” js -->
  <!-- <script src="/"></script> -->
</th:block>

</html>