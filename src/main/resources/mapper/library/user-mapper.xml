<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="userMenuMapper">

    <!-- 유저 승인, cardNum이 0인 회원 조회 -->
    <select id="userSearch" resultMap="memberMapper.users">
        SELECT USER_CODE
            , USER_ID
            , USER_NAME
            , GENDER
            , USER_TEL
            , IS_ADMIN
            , CARD_NUM
        FROM USERS
        <if test='userName1 != null and !userName1.equals("")'>
            WHERE USER_NAME BETWEEN #{userName1} AND '힣'
        </if>
        <if test='userName2 != null and !userName2.equals("")'>
            WHERE USER_NAME BETWEEN #{userName2} AND '힣'
        </if>
        <if test='userName1 != null and !userName1.equals("") and userName2 != null and !userName2.equals("")'>
            WHERE USER_NAME BETWEEN #{userName1} AND #{userName2}
        </if>
        <if test='userTel != null and !userTel.equals("")'>
            WHERE USER_TEL LIKE CONCAT('%', #{userTel}, '%')
        </if>
        <if test='gender != null and !gender.equals("")'>
            WHERE GENDER LIKE CONCAT('%', #{gender}, '%')
        </if>
        <if test='orderStandard != null and !orderStandard.equals("")'>
            ORDER BY #{orderStandard} DESC
        </if>
    </select>

    <!--    <select id="">-->
    <!--   유저 관리 기능 만들 때 다음 번호를 조회 후 insert로 cardNum 주기 -->
    <!--    <select id="selectNextCardNum" resultType="int">-->
    <!--        SELECT IFNULL(MAX(CARD_NUM), 0) + 1 FROM USERS-->
    <!--    </select>-->
    <!--    </select>-->

    <!-- cardNum 업데이트 -->
    <update id="updateCardNum">
        UPDATE USERS
        SET CARD_NUM = IFNULL(MAX(CARD_NUM), 0) + 1
        WHERE USER_CODE= #{userCode}
    </update>


</mapper>































